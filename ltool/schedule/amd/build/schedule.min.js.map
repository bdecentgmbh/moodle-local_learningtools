{"version":3,"file":"schedule.min.js","sources":["../src/schedule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Schedule ltool define js.\n * @module   ltool_schedule\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['core/fragment', 'core/modal_factory', 'core/str', 'core/modal_events', 'core/notification'],\n function(Fragment, ModalFactory, String, ModalEvents, Notification) {\n\n    /**\n     * Controls Schedule tool action.\n     * @param {object} params\n     */\n    var LearningToolSchedule = function(params) {\n        var self = this;\n        var scheduleInfo = document.querySelector(\".ltoolschedule-info #ltoolschedule-action\");\n        if (scheduleInfo) {\n            // Hover color.\n            var schedulehovercolor = scheduleInfo.getAttribute(\"data-hovercolor\");\n            var schedulefontcolor = scheduleInfo.getAttribute(\"data-fontcolor\");\n            if (schedulehovercolor && schedulefontcolor) {\n                scheduleInfo.addEventListener(\"mouseover\", function() {\n                    document.querySelector('#ltoolschedule-info p').style.background = schedulehovercolor;\n                    document.querySelector('#ltoolschedule-info p').style.color = schedulefontcolor;\n                });\n            }\n            scheduleInfo.addEventListener('click', function() {\n                self.displaySchedulebox(params);\n            });\n        }\n\n    };\n\n    LearningToolSchedule.prototype.displaySchedulebox = function(params) {\n        var self = this;\n        var strschedule = String.get_string('schedule', 'local_learningtools');\n        ModalFactory.create({\n            title: strschedule,\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: self.getScheduleAction(params),\n            large: true\n        }).then(function(modal) {\n            modal.show();\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n\n            modal.getRoot().on(ModalEvents.save, function(e) {\n                e.preventDefault();\n                var innerform = document.querySelectorAll('#ltoolschedule-editorbox form')[0];\n                if (innerform) {\n                    innerform.addEventListener('submit', function(e) {\n                        e.preventDefault();\n                    });\n                }\n\n                var schedulenameinfo = document.querySelectorAll(\"#ltoolschedule-editorbox input[name='schedulename']\")[0];\n                if (schedulenameinfo.value) {\n                    self.submitFormData(params.contextid);\n                    modal.getRoot().submit();\n                    modal.hide();\n                    window.location.reload();\n                }\n            });\n            return modal;\n        }).fail(Notification.exception);\n\n    };\n\n    LearningToolSchedule.prototype.submitFormData = function(contextid) {\n        var modalform = document.querySelectorAll('#ltoolschedule-editorbox form')[0];\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\n        Fragment.loadFragment('ltool_schedule', 'set_calendar_event', contextid, {'formdata': formData});\n        modalform.querySelector(\"input[name=submitbutton]\").click();\n        return true;\n    };\n\n    LearningToolSchedule.prototype.getScheduleAction = function(params) {\n        return Fragment.loadFragment('ltool_schedule', 'get_schedule_form', params.contextid, params);\n    };\n\n    return {\n        init: function(params) {\n            return new LearningToolSchedule(params);\n        }\n    };\n });"],"names":["define","Fragment","ModalFactory","String","ModalEvents","Notification","LearningToolSchedule","params","self","this","scheduleInfo","document","querySelector","schedulehovercolor","getAttribute","schedulefontcolor","addEventListener","style","background","color","displaySchedulebox","prototype","strschedule","get_string","create","title","type","types","SAVE_CANCEL","body","getScheduleAction","large","then","modal","show","getRoot","on","hidden","destroy","save","e","preventDefault","innerform","querySelectorAll","value","submitFormData","contextid","submit","hide","window","location","reload","fail","exception","modalform","formData","URLSearchParams","FormData","toString","loadFragment","click","init"],"mappings":";;;;;;AAsBCA,iCAAO,CAAC,gBAAiB,qBAAsB,WAAY,oBAAqB,sBAChF,SAASC,SAAUC,aAAcC,OAAQC,YAAaC,kBAM/CC,qBAAuB,SAASC,YAC5BC,KAAOC,KACPC,aAAeC,SAASC,cAAc,gDACtCF,aAAc,KAEVG,mBAAqBH,aAAaI,aAAa,mBAC/CC,kBAAoBL,aAAaI,aAAa,kBAC9CD,oBAAsBE,mBACtBL,aAAaM,iBAAiB,aAAa,WACvCL,SAASC,cAAc,yBAAyBK,MAAMC,WAAaL,mBACnEF,SAASC,cAAc,yBAAyBK,MAAME,MAAQJ,qBAGtEL,aAAaM,iBAAiB,SAAS,WACnCR,KAAKY,mBAAmBb,oBAMpCD,qBAAqBe,UAAUD,mBAAqB,SAASb,YACrDC,KAAOC,KACPa,YAAcnB,OAAOoB,WAAW,WAAY,uBAChDrB,aAAasB,OAAO,CAChBC,MAAOH,YACPI,KAAMxB,aAAayB,MAAMC,YACzBC,KAAMrB,KAAKsB,kBAAkBvB,QAC7BwB,OAAO,IACRC,MAAK,SAASC,cACbA,MAAMC,OACND,MAAME,UAAUC,GAAGhC,YAAYiC,QAAQ,WACnCJ,MAAMK,aAGVL,MAAME,UAAUC,GAAGhC,YAAYmC,MAAM,SAASC,GAC1CA,EAAEC,qBACEC,UAAY/B,SAASgC,iBAAiB,iCAAiC,GACvED,WACAA,UAAU1B,iBAAiB,UAAU,SAASwB,GAC1CA,EAAEC,oBAIa9B,SAASgC,iBAAiB,uDAAuD,GACnFC,QACjBpC,KAAKqC,eAAetC,OAAOuC,WAC3Bb,MAAME,UAAUY,SAChBd,MAAMe,OACNC,OAAOC,SAASC,aAGjBlB,SACRmB,KAAK/C,aAAagD,YAIzB/C,qBAAqBe,UAAUwB,eAAiB,SAASC,eACjDQ,UAAY3C,SAASgC,iBAAiB,iCAAiC,GACvEY,SAAW,IAAIC,gBAAgB,IAAIC,SAASH,YAAYI,kBAC5DzD,SAAS0D,aAAa,iBAAkB,qBAAsBb,UAAW,UAAaS,WACtFD,UAAU1C,cAAc,4BAA4BgD,SAC7C,GAGXtD,qBAAqBe,UAAUS,kBAAoB,SAASvB,eACjDN,SAAS0D,aAAa,iBAAkB,oBAAqBpD,OAAOuC,UAAWvC,SAGnF,CACHsD,KAAM,SAAStD,eACJ,IAAID,qBAAqBC"}