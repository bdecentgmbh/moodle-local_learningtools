{"version":3,"sources":["../src/schedule.js"],"names":["define","$","Fragment","ModalFactory","String","ModalEvents","Notification","LearningToolSchedule","params","self","scheduleInfo","document","querySelector","schedulehovercolor","getAttribute","schedulefontcolor","addEventListener","style","background","color","displaySchedulebox","prototype","strschedule","get_string","create","title","type","types","SAVE_CANCEL","body","getScheduleAction","large","then","modal","getRoot","on","save","e","preventDefault","target","find","attr","submit","schedulenameinfo","querySelectorAll","value","submitFormData","contextid","successinfo","when","done","localizedEditString","addNotification","message","ltools","disappertimenotify","setTimeout","innerHTML","hide","hidden","destroy","show","fail","exception","modalform","formData","URLSearchParams","FormData","toString","loadFragment","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Schedule ltool define js.\n * @module   ltool_schedule\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define(['jquery', 'core/fragment', 'core/modal_factory', 'core/str', 'core/modal_events', 'core/notification'],\n function($, Fragment, ModalFactory, String, ModalEvents, Notification) {\n    /* global ltools */\n\n    /**\n     * Controls Schedule tool action.\n     * @param {object} params\n     */\n    var LearningToolSchedule = function(params) {\n        var self = this;\n        var scheduleInfo = document.querySelector(\".ltoolschedule-info #ltoolschedule-action\");\n        if (scheduleInfo) {\n            // Hover color.\n            var schedulehovercolor = scheduleInfo.getAttribute(\"data-hovercolor\");\n            var schedulefontcolor = scheduleInfo.getAttribute(\"data-fontcolor\");\n            if (schedulehovercolor && schedulefontcolor) {\n                scheduleInfo.addEventListener(\"mouseover\", function() {\n                    document.querySelector('#ltoolschedule-info p').style.background = schedulehovercolor;\n                    document.querySelector('#ltoolschedule-info p').style.color = schedulefontcolor;\n                });\n            }\n            scheduleInfo.addEventListener('click', function() {\n                self.displaySchedulebox(params);\n            });\n        }\n\n    };\n\n    LearningToolSchedule.prototype.displaySchedulebox = function(params) {\n        var self = this;\n        var strschedule = String.get_string('schedule', 'local_learningtools');\n        return ModalFactory.create({\n            title: strschedule,\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: self.getScheduleAction(params),\n            large: true\n        }).then(function(modal) {\n            modal.getRoot().on(ModalEvents.save, e => {\n                // Trigger a form submission, so that any mform elements can do final tricks before the form submission\n                // is processed.\n                // The actual submit even tis captured in the next handler.\n                e.preventDefault();\n                $(e.target).find(\"button[data-action=save]\").attr(\"disabled\", true);\n                modal.getRoot().find('form').submit();\n            });\n\n            modal.getRoot().on('submit', 'form', e => {\n                e.preventDefault();\n                var schedulenameinfo = document.querySelectorAll(\"#ltoolschedule-editorbox input[name='schedulename']\")[0];\n                if (schedulenameinfo.value) {\n                    self.submitFormData(params.contextid);\n                    var successinfo = String.get_string('successtoolschedule', 'local_learningtools');\n                    $.when(successinfo).done(function(localizedEditString) {\n                        Notification.addNotification({\n                            message: localizedEditString,\n                            type: \"success\"\n                        });\n                    });\n                    if (ltools.disappertimenotify != 0) {\n                        setTimeout(function() {\n                            document.querySelector(\"span.notifications\").innerHTML = \"\";\n                        }, ltools.disappertimenotify);\n                    }\n                }\n                modal.hide();\n            });\n\n            modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n            });\n            modal.show();\n            return modal;\n        }).fail(Notification.exception);\n\n    };\n\n    LearningToolSchedule.prototype.submitFormData = function(contextid) {\n        var modalform = document.querySelectorAll('#ltoolschedule-editorbox form')[0];\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\n        Fragment.loadFragment('ltool_schedule', 'set_calendar_event', contextid, {'formdata': formData});\n        return true;\n    };\n\n    LearningToolSchedule.prototype.getScheduleAction = function(params) {\n        return Fragment.loadFragment('ltool_schedule', 'get_schedule_form', params.contextid, params);\n    };\n\n    return {\n        init: function(params) {\n            return new LearningToolSchedule(params);\n        }\n    };\n });"],"file":"schedule.min.js"}