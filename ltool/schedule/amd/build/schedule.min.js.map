{"version":3,"file":"schedule.min.js","sources":["../src/schedule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Schedule ltool define js.\r\n * @module   ltool_schedule\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n define(['jquery', 'core/fragment', 'core/modal_factory', 'core/str', 'core/modal_events', 'core/notification'],\r\n function($, Fragment, ModalFactory, String, ModalEvents, Notification) {\r\n\r\n    /* global ltools */\r\n\r\n    /**\r\n     * Controls Schedule tool action.\r\n     * @param {object} params\r\n     */\r\n    var LearningToolSchedule = function(params) {\r\n        var self = this;\r\n        var scheduleInfo = document.querySelector(\".ltoolschedule-info #ltoolschedule-action\");\r\n        if (scheduleInfo) {\r\n            // Hover color.\r\n            var schedulehovercolor = scheduleInfo.getAttribute(\"data-hovercolor\");\r\n            var schedulefontcolor = scheduleInfo.getAttribute(\"data-fontcolor\");\r\n            if (schedulehovercolor && schedulefontcolor) {\r\n                scheduleInfo.addEventListener(\"mouseover\", function() {\r\n                    document.querySelector('#ltoolschedule-info p').style.background = schedulehovercolor;\r\n                    document.querySelector('#ltoolschedule-info p').style.color = schedulefontcolor;\r\n                });\r\n            }\r\n            scheduleInfo.addEventListener('click', function() {\r\n                self.displaySchedulebox(params);\r\n            });\r\n        }\r\n\r\n    };\r\n\r\n    LearningToolSchedule.prototype.displaySchedulebox = function(params) {\r\n        var self = this;\r\n        var strschedule = String.get_string('schedule', 'local_learningtools');\r\n        return ModalFactory.create({\r\n            title: strschedule,\r\n            type: ModalFactory.types.SAVE_CANCEL,\r\n            body: self.getScheduleAction(params),\r\n            large: true\r\n        }).then(function(modal) {\r\n            modal.getRoot().on(ModalEvents.save, e => {\r\n                // Trigger a form submission, so that any mform elements can do final tricks before the form submission\r\n                // is processed.\r\n                // The actual submit even tis captured in the next handler.\r\n                e.preventDefault();\r\n                $(e.target).find(\"button[data-action=save]\").attr(\"disabled\", true);\r\n                modal.getRoot().find('form').submit();\r\n            });\r\n\r\n            modal.getRoot().on('submit', 'form', e => {\r\n                e.preventDefault();\r\n                var schedulenameinfo = document.querySelectorAll(\"#ltoolschedule-editorbox input[name='schedulename']\")[0];\r\n                if (schedulenameinfo.value) {\r\n                    self.submitFormData(params.contextid);\r\n                    var successinfo = String.get_string('successtoolschedule', 'local_learningtools');\r\n                    $.when(successinfo).done(function(localizedEditString) {\r\n                        Notification.addNotification({\r\n                            message: localizedEditString,\r\n                            type: \"success\"\r\n                        });\r\n                    });\r\n                    if (ltools.disappertimenotify != 0) {\r\n                        setTimeout(function() {\r\n                            document.querySelector(\"span.notifications\").innerHTML = \"\";\r\n                        }, ltools.disappertimenotify);\r\n                    }\r\n                }\r\n                modal.hide();\r\n            });\r\n\r\n            modal.getRoot().on(ModalEvents.hidden, function() {\r\n                modal.destroy();\r\n            });\r\n            modal.show();\r\n            return modal;\r\n        }).fail(Notification.exception);\r\n\r\n    };\r\n\r\n    LearningToolSchedule.prototype.submitFormData = function(contextid) {\r\n        var modalform = document.querySelectorAll('#ltoolschedule-editorbox form')[0];\r\n        var formData = new URLSearchParams(new FormData(modalform)).toString();\r\n        Fragment.loadFragment('ltool_schedule', 'set_calendar_event', contextid, {'formdata': formData});\r\n        return true;\r\n    };\r\n\r\n    LearningToolSchedule.prototype.getScheduleAction = function(params) {\r\n        return Fragment.loadFragment('ltool_schedule', 'get_schedule_form', params.contextid, params);\r\n    };\r\n\r\n    return {\r\n        init: function(params) {\r\n            return new LearningToolSchedule(params);\r\n        }\r\n    };\r\n });"],"names":["define","$","Fragment","ModalFactory","String","ModalEvents","Notification","LearningToolSchedule","params","self","this","scheduleInfo","document","querySelector","schedulehovercolor","getAttribute","schedulefontcolor","addEventListener","style","background","color","displaySchedulebox","prototype","strschedule","get_string","create","title","type","types","SAVE_CANCEL","body","getScheduleAction","large","then","modal","getRoot","on","save","e","preventDefault","target","find","attr","submit","querySelectorAll","value","submitFormData","contextid","successinfo","when","done","localizedEditString","addNotification","message","ltools","disappertimenotify","setTimeout","innerHTML","hide","hidden","destroy","show","fail","exception","modalform","formData","URLSearchParams","FormData","toString","loadFragment","init"],"mappings":";;;;;;AAsBCA,iCAAO,CAAC,SAAU,gBAAiB,qBAAsB,WAAY,oBAAqB,sBAC1F,SAASC,EAAGC,SAAUC,aAAcC,OAAQC,YAAaC,kBAQlDC,qBAAuB,SAASC,YAC5BC,KAAOC,KACPC,aAAeC,SAASC,cAAc,gDACtCF,aAAc,KAEVG,mBAAqBH,aAAaI,aAAa,mBAC/CC,kBAAoBL,aAAaI,aAAa,kBAC9CD,oBAAsBE,mBACtBL,aAAaM,iBAAiB,aAAa,WACvCL,SAASC,cAAc,yBAAyBK,MAAMC,WAAaL,mBACnEF,SAASC,cAAc,yBAAyBK,MAAME,MAAQJ,qBAGtEL,aAAaM,iBAAiB,SAAS,WACnCR,KAAKY,mBAAmBb,oBAMpCD,qBAAqBe,UAAUD,mBAAqB,SAASb,YACrDC,KAAOC,KACPa,YAAcnB,OAAOoB,WAAW,WAAY,8BACzCrB,aAAasB,OAAO,CACvBC,MAAOH,YACPI,KAAMxB,aAAayB,MAAMC,YACzBC,KAAMrB,KAAKsB,kBAAkBvB,QAC7BwB,OAAO,IACRC,MAAK,SAASC,cACbA,MAAMC,UAAUC,GAAG/B,YAAYgC,MAAMC,IAIjCA,EAAEC,iBACFtC,EAAEqC,EAAEE,QAAQC,KAAK,4BAA4BC,KAAK,YAAY,GAC9DR,MAAMC,UAAUM,KAAK,QAAQE,YAGjCT,MAAMC,UAAUC,GAAG,SAAU,QAAQE,OACjCA,EAAEC,iBACqB3B,SAASgC,iBAAiB,uDAAuD,GACnFC,MAAO,CACxBpC,KAAKqC,eAAetC,OAAOuC,eACvBC,YAAc5C,OAAOoB,WAAW,sBAAuB,uBAC3DvB,EAAEgD,KAAKD,aAAaE,MAAK,SAASC,qBAC9B7C,aAAa8C,gBAAgB,CACzBC,QAASF,oBACTxB,KAAM,eAGmB,GAA7B2B,OAAOC,oBACPC,YAAW,WACP5C,SAASC,cAAc,sBAAsB4C,UAAY,KAC1DH,OAAOC,oBAGlBrB,MAAMwB,UAGVxB,MAAMC,UAAUC,GAAG/B,YAAYsD,QAAQ,WACnCzB,MAAM0B,aAEV1B,MAAM2B,OACC3B,SACR4B,KAAKxD,aAAayD,YAIzBxD,qBAAqBe,UAAUwB,eAAiB,SAASC,eACjDiB,UAAYpD,SAASgC,iBAAiB,iCAAiC,GACvEqB,SAAW,IAAIC,gBAAgB,IAAIC,SAASH,YAAYI,kBAC5DlE,SAASmE,aAAa,iBAAkB,qBAAsBtB,UAAW,UAAakB,YAC/E,GAGX1D,qBAAqBe,UAAUS,kBAAoB,SAASvB,eACjDN,SAASmE,aAAa,iBAAkB,oBAAqB7D,OAAOuC,UAAWvC,SAGnF,CACH8D,KAAM,SAAS9D,eACJ,IAAID,qBAAqBC"}