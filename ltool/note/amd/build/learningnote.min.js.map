{"version":3,"sources":["../src/learningnote.js"],"names":["define","$","ModalFactory","String","Fragment","ModalEvents","Ajax","notification","learning_tool_note_action","contextid","params","show_modal_lttool","sorttypefilter","document","querySelector","addEventListener","sorttype","getAttribute","note_sort_action_page","removeURLParameter","url","parameter","urlparts","split","length","prefix","encodeURIComponent","pars","i","lastIndexOf","splice","join","notesinfo","newnote","get_string","when","done","localizedEditString","ltoolnotebody","getElementsByTagName","classList","contains","add","create","title","get_popout_action","type","types","SAVE_CANCEL","body","getnoteaction","large","then","modal","show","getRoot","on","hidden","destroy","save","e","preventDefault","submitForm","M","cfg","wwwroot","pagetype","contextlevel","course","user","pageurl","heading","hide","window","open","onsubmit","submitFormData","location","href","indexOf","para","submit","modalform","formData","serialize","notesuccess","call","methodname","args","formdata","response","noteinfo","innerHTML","addNotification","message","ltools","disappertimenotify","setTimeout","fail","handleFailedResponse","loadFragment","form","nodeName","j","q","elements","name","push","value","checked","options","selected","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Notes ltool define js.\r\n * @package   ltool_note\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/fragment', 'core/modal_events', 'core/ajax', 'core/notification'],\r\n    function($, ModalFactory, String, Fragment, ModalEvents, Ajax, notification){\r\n\r\n    /**\r\n     * Controls notes tool action.\r\n     * @param {int} context id\r\n     * @param {object} notes info params\r\n     */\r\n    function learning_tool_note_action(contextid, params) {\r\n        show_modal_lttool(contextid, params);\r\n        var sorttypefilter = document.querySelector(\".ltnote-sortfilter i#notessorttype\");\r\n        if (sorttypefilter) {\r\n            sorttypefilter.addEventListener(\"click\", function() {\r\n                var sorttype = this.getAttribute('data-type');\r\n                note_sort_action_page(sorttype);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean the url parameters.\r\n     * @param {string} page url.\r\n     * @param {string} url parameter.\r\n     * @return {url} sort url\r\n     */\r\n    function removeURLParameter(url, parameter) {\r\n        //prefer to use l.search if you have a location/link object\r\n        var urlparts= url.split('?');\r\n        if (urlparts.length>=2) {\r\n\r\n            var prefix= encodeURIComponent(parameter)+'=';\r\n            var pars= urlparts[1].split(/[&;]/g);\r\n\r\n            //reverse iteration as may be destructive\r\n            for (var i= pars.length; i-- > 0;) {\r\n                //idiom for string.startsWith\r\n                if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                    pars.splice(i, 1);\r\n                }\r\n            }\r\n\r\n            url= urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : \"\");\r\n            return url;\r\n        } else {\r\n            return url;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Display the modal popup.\r\n     * @param {int} context id\r\n     * @param {object} notes info params\r\n     * @return {void} \r\n     */\r\n    function show_modal_lttool(contextid, params) {\r\n\r\n        var notesinfo = document.querySelector(\".ltnoteinfo #ltnote-action\");\r\n        notesinfo.addEventListener(\"click\", function() {\r\n            var newnote = String.get_string('newnote', 'local_learningtools');\r\n            \r\n            $.when(newnote).done(function(localizedEditString) {\r\n                // add class.\r\n                var ltoolnotebody  = document.getElementsByTagName('body')[0];\r\n                if (!ltoolnotebody.classList.contains('learningtool-note')) {\r\n                    ltoolnotebody.classList.add('learningtool-note')\r\n                }\r\n\r\n                ModalFactory.create({\r\n                    title: localizedEditString + get_popout_action(params),\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    body: getnoteaction(contextid, params),\r\n                    large: true\r\n                }).then(function(modal){\r\n\r\n                    modal.show();\r\n                    \r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n        \r\n                    modal.getRoot().on(ModalEvents.save, function(e) { \r\n\r\n                        e.preventDefault();\r\n                        submitForm(modal);\r\n                    });\r\n\r\n                    document.querySelector(\"#popout-action\").addEventListener('click', function() {\r\n                        var url = M.cfg.wwwroot+\"/local/learningtools/ltool/note/popout.php?contextid=\"+\r\n                        params.contextid+\"&pagetype=\"+params.pagetype+\"&contextlevel=\"+params.contextlevel+\r\n                        \"&course=\"+params.course+\"&user=\"+params.user+\"&pageurl=\"+params.pageurl+\"&title=\"+params.title\r\n                        +\"&heading=\"+params.heading; \r\n                        modal.hide();\r\n                        window.open(url, '_blank');\r\n                    });\r\n\r\n                    document.body.onsubmit = function (e) {\r\n                        e.preventDefault();\r\n                        submitFormData(modal, contextid, params)\r\n                    };\r\n                });\r\n            });\r\n\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Sort the bookmarks list.\r\n     * @param {string} sort type\r\n     * @return {void}\r\n     */\r\n    function note_sort_action_page(sorttype) {\r\n\r\n        var pageurl = window.location.href;\r\n        pageurl = removeURLParameter(pageurl, 'sorttype');\r\n\r\n        if(sorttype == 'asc') {\r\n            sorttype = 'desc';\r\n        } else if (sorttype == 'desc') {\r\n            sorttype = 'asc';\r\n        }\r\n        \r\n        if (pageurl.indexOf('?') > -1) {\r\n            var para = '&';\r\n        } else {\r\n            var para = '?';\r\n        }\r\n\r\n        pageurl = pageurl+para+'sorttype='+ sorttype;\r\n        window.open(pageurl, '_self');\r\n    }\r\n\r\n    /**\r\n     * Popout url action html.\r\n     * @param {object} notes params\r\n     * @return {string} popout html\r\n     */\r\n    function get_popout_action(params) {\r\n        var popouthtml = \"<div class='popout-block'><button type='submit' id='popout-action' name='popoutsubmit'>Pop out</button><i class='fa fa-window-restore'></i></div>\";\r\n        return popouthtml;\r\n    }\r\n\r\n    /**\r\n     * Submit the modal form.\r\n     * @param {object} modal object\r\n     */\r\n    function submitForm(modal) {\r\n        modal.getRoot().submit();\r\n    }\r\n\r\n    /**\r\n     * Submit the modal data form.\r\n     * @param {object} modal object\r\n     * @param {int} context id\r\n     * @return {void} ajax response.\r\n     */\r\n    function submitFormData(modal, contextid) {\r\n        \r\n        var modalform = document.querySelector('.ltoolusernotes form');\r\n        var formData = serialize(modalform);\r\n        var notesuccess = String.get_string('successnotemessage', 'local_learningtools');\r\n        Ajax.call([{\r\n            methodname: 'ltool_note_save_usernote',\r\n            args: {contextid: contextid, formdata: formData},\r\n            done: function(response) {\r\n                // insert data into notes badge\r\n                if (response) {\r\n                    var noteinfo = document.querySelector(\".ltnoteinfo span\");\r\n                    if (!noteinfo.classList.contains('ticked')) {\r\n                        noteinfo.classList.add('ticked');\r\n                    }\r\n                    noteinfo.innerHTML = response;\r\n                }\r\n                \r\n                modal.hide();\r\n               // window.location.reload();\r\n                $.when(notesuccess).done(function(localizedEditString){\r\n                    notification.addNotification({\r\n                        message: localizedEditString,\r\n                        type: \"success\"\r\n                    });\r\n                }); \r\n\r\n                if (ltools.disappertimenotify != 0) {\r\n                    setTimeout(function () {\r\n                        document.querySelector(\"span.notifications\").innerHTML = \"\";\r\n                    }, ltools.disappertimenotify);\r\n                }  \r\n            },\r\n            fail: handleFailedResponse()\r\n        }]); \r\n    }\r\n\r\n    function handleFailedResponse() {\r\n\r\n    }\r\n\r\n    /**\r\n     * Submit the modal data form.\r\n     * @param {int} contextid\r\n     * @param {object} list of the notes params.\r\n     */\r\n    function getnoteaction(contextid, params) {\r\n        params.contextid = contextid;\r\n        return Fragment.loadFragment('ltool_note', 'get_note_form', contextid, params);\r\n    }\r\n\r\n    /**\r\n     * Get the form seialize data\r\n     * @param {object} form object\r\n     * @return {mixed} list of the form params.\r\n     */\r\n    function serialize(form) {\r\n        if (!form || form.nodeName !== \"FORM\") {\r\n                return;\r\n        }\r\n        var i, j, q = [];\r\n        for (i = form.elements.length - 1; i >= 0; i = i - 1) {\r\n            if (form.elements[i].name === \"\") {\r\n                continue;\r\n            }\r\n            switch (form.elements[i].nodeName) {\r\n                case 'INPUT':\r\n                    switch (form.elements[i].type) {\r\n                        case 'text':\r\n                        case 'tel':\r\n                        case 'email':\r\n                        case 'hidden':\r\n                        case 'password':\r\n                        case 'button':\r\n                        case 'reset':\r\n                        case 'submit':\r\n                            q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                            break;\r\n                        case 'checkbox':\r\n                        case 'radio':\r\n                            if (form.elements[i].checked) {\r\n                                    q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                            }                                               \r\n                            break;\r\n                    }\r\n                    break;\r\n                    case 'file':\r\n                    break; \r\n                case 'TEXTAREA':\r\n                        q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                        break;\r\n                case 'SELECT':\r\n                    switch (form.elements[i].type) {\r\n                        case 'select-one':\r\n                            q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                            break;\r\n                        case 'select-multiple':\r\n                            for (j = form.elements[i].options.length - 1; j >= 0; j = j - 1) {\r\n                                if (form.elements[i].options[j].selected) {\r\n                                        q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].options[j].value));\r\n                                }\r\n                            }\r\n                            break;\r\n                    }\r\n                    break;\r\n                case 'BUTTON':\r\n                    switch (form.elements[i].type) {\r\n                        case 'reset':\r\n                        case 'submit':\r\n                        case 'button':\r\n                            q.push(form.elements[i].name + \"=\" + encodeURIComponent(form.elements[i].value));\r\n                            break;\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        return q.join(\"&\");\r\n    }\r\n\r\n\r\n    return {\r\n        init: function(contextid, params) {\r\n            learning_tool_note_action(contextid, params);\r\n        }\r\n    };\r\n});"],"file":"learningnote.min.js"}