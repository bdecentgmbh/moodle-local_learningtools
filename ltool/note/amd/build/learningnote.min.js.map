{"version":3,"sources":["../src/learningnote.js"],"names":["define","$","ModalFactory","String","Fragment","ModalEvents","Ajax","notification","learning_tool_note_action","contextid","params","show_modal_lttool","on","newnote","get_string","when","done","localizedEditString","create","title","get_popout_action","type","types","SAVE_CANCEL","body","getnoteaction","large","then","modal","show","getRoot","hidden","destroy","save","e","preventDefault","submitForm","delegate","console","log","url","M","cfg","wwwroot","pagetype","contextlevel","course","user","pageurl","heading","hide","window","open","submitFormData","find","submit","formData","serialize","notesuccess","call","methodname","args","formdata","response","hasClass","addClass","empty","append","addNotification","message","ltools","disappertimenotify","setTimeout","fail","handleFailedResponse","loadFragment","init"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'core/str', 'core/fragment', 'core/modal_events', 'core/ajax', 'core/notification'],\r\n    function($, ModalFactory, String, Fragment, ModalEvents, Ajax, notification){\r\n\r\n    function learning_tool_note_action(contextid, params) {\r\n        show_modal_lttool(contextid, params);\r\n    }\r\n\r\n    function show_modal_lttool(contextid, params) {\r\n   \r\n        $(\".ltnoteinfo #ltnote-action\").on('click', function() {\r\n            var newnote = String.get_string('newnote', 'local_learningtools');\r\n            \r\n            $.when(newnote).done(function(localizedEditString) {\r\n\r\n                ModalFactory.create({\r\n                    title: localizedEditString + get_popout_action(params),\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    body: getnoteaction(contextid, params),\r\n                    large: true\r\n                }).then(function(modal){\r\n\r\n                    modal.show();\r\n\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n        \r\n                    modal.getRoot().on( ModalEvents.save, function(e) { \r\n\r\n                        e.preventDefault();\r\n                        submitForm(modal);\r\n                    });\r\n\r\n                    modal.getRoot().delegate('#popout-action', 'click', function(e) {\r\n/*                        var url = params.pageurl;\r\n                        if (url.indexOf('?') > -1) {\r\n                            var para = '&';\r\n                        } else {\r\n                            var para = '?';\r\n                        }\r\n                        url = url+para+\"notes=trigger\";*/\r\n                        console.log(params);\r\n\r\n                        var url = M.cfg.wwwroot+\"/local/learningtools/ltool/note/popout.php?contextid=\"+\r\n                        params.contextid+\"&pagetype=\"+params.pagetype+\"&contextlevel=\"+params.contextlevel+\r\n                        \"&course=\"+params.course+\"&user=\"+params.user+\"&pageurl=\"+params.pageurl+\"&title=\"+params.title\r\n                        +\"&heading=\"+params.heading; \r\n\r\n                        modal.hide();\r\n                        window.open(url, '_blank');\r\n                        //$(page).find(\".ltnoteinfo button\").trigger('click');\r\n                    });\r\n\r\n                    modal.getRoot().delegate('form', 'submit', function(e) {\r\n                        e.preventDefault(); \r\n                        submitFormData(modal, contextid, params)            \r\n                    });\r\n\r\n\r\n                });\r\n            });\r\n\r\n        });\r\n    }\r\n\r\n    function get_popout_action(params) {\r\n        var popouthtml = \"<div class='popout-block'><button type='submit' id='popout-action' name='popoutsubmit'>Pop out</button><i class='fa fa-window-restore'></i></div>\";\r\n        return popouthtml;\r\n    }\r\n\r\n    function submitForm(modal) {\r\n\t\tmodal.getRoot().find('form').submit();\r\n\t}\r\n\r\n    function submitFormData(modal, contextid) {\r\n\t\tvar formData = modal.getRoot().find('form').serialize();\r\n        var notesuccess = String.get_string('successnotemessage', 'local_learningtools');\r\n\t\tAjax.call([{\r\n\t\t\tmethodname: 'ltool_note_save_usernote',\r\n\t\t\targs: {contextid: contextid, formdata: formData},\r\n\t\t\tdone: function(response) {\r\n                // insert data into notes badge\r\n                if (response) {\r\n                    \r\n                    if ($(\".ltnoteinfo span\").hasClass('ticked') != true) {\r\n                        $(\".ltnoteinfo span\").addClass('ticked');\r\n                    }\r\n                    $(\".ltnoteinfo span\").empty();\r\n                    $(\".ltnoteinfo span\").append(response);\r\n                }\r\n\r\n\t\t\t\tmodal.hide();\r\n\t\t\t   // window.location.reload();\r\n                $.when(notesuccess).done(function(localizedEditString){\r\n                    notification.addNotification({\r\n                        message: localizedEditString,\r\n                        type: \"success\"\r\n                    });\r\n                }); \r\n\r\n                if (ltools.disappertimenotify != 0) {\r\n                    setTimeout(function () {\r\n                        $(\"span.notifications\").empty();\r\n                    }, ltools.disappertimenotify);\r\n                }  \r\n\t\t\t},\r\n\t\t\tfail: handleFailedResponse()\r\n\t\t}]);  \r\n\t}\r\n\r\n    function handleFailedResponse() {\r\n\r\n    }\r\n\r\n    function getnoteaction(contextid, params) {\r\n        params.contextid = contextid;\r\n        return Fragment.loadFragment('ltool_note', 'get_note_form', contextid, params);\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        init: function(contextid, params) {\r\n            learning_tool_note_action(contextid, params);\r\n        }\r\n    };\r\n});"],"file":"learningnote.min.js"}