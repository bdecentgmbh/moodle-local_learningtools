{"version":3,"sources":["../src/learningnote.js"],"names":["define","$","ModalFactory","String","Fragment","ModalEvents","Ajax","notification","learning_tool_note_action","contextid","params","show_modal_lttool","on","newnote","get_string","when","done","localizedEditString","create","title","get_popout_action","type","types","SAVE_CANCEL","body","getnoteaction","large","then","modal","show","getRoot","hidden","destroy","save","e","preventDefault","submitForm","delegate","url","M","cfg","wwwroot","pagetype","contextlevel","course","user","pageurl","hide","window","open","submitFormData","find","submit","formData","serialize","notesuccess","call","methodname","args","formdata","addNotification","message","disappertimenotify","setTimeout","empty","fail","handleFailedResponse","loadFragment","init"],"mappings":"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","sourcesContent":["define(['jquery', 'core/modal_factory', 'core/str', 'core/fragment', 'core/modal_events', 'core/ajax', 'core/notification'],\r\n    function($, ModalFactory, String, Fragment, ModalEvents, Ajax, notification){\r\n\r\n    function learning_tool_note_action(contextid, params) {\r\n        show_modal_lttool(contextid, params);\r\n    }\r\n\r\n    function show_modal_lttool(contextid, params) {\r\n   \r\n        $(\".ltnoteinfo #ltnote-action\").on('click', function() {\r\n            var newnote = String.get_string('newnote', 'local_learningtools');\r\n            \r\n            $.when(newnote).done(function(localizedEditString) {\r\n\r\n                ModalFactory.create({\r\n                    title: localizedEditString + get_popout_action(params),\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    body: getnoteaction(contextid, params),\r\n                    large: true\r\n                }).then(function(modal){\r\n\r\n                    modal.show();\r\n\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                        modal.destroy();\r\n                    });\r\n        \r\n                    modal.getRoot().on( ModalEvents.save, function(e) { \r\n\r\n                        e.preventDefault();\r\n                        submitForm(modal);\r\n                    });\r\n\r\n                    modal.getRoot().delegate('#popout-action', 'click', function(e) {\r\n\r\n                        var url = M.cfg.wwwroot+\"/local/learningtools/ltool/note/popoutaction.php?contextid=\"+\r\n                        params.contextid+\"&pagetype=\"+params.pagetype+\"&contextlevel=\"+params.contextlevel+\r\n                        \"&course=\"+params.course+\"&user=\"+params.user+\"&pageurl=\"+params.pageurl;\r\n                        modal.hide();\r\n                        window.open(url, '_blank');\r\n                    });\r\n\r\n                    modal.getRoot().delegate('form', 'submit', function(e) {\r\n                        e.preventDefault(); \r\n                        submitFormData(modal, contextid, params)            \r\n                    });\r\n\r\n\r\n                });\r\n            });\r\n\r\n        });\r\n    }\r\n\r\n    function get_popout_action(params) {\r\n        var popouthtml = \"<div class='popout-block'><button type='submit' id='popout-action' name='popoutsubmit'>Pop out</button><i class='fa fa-window-restore'></i></div>\";\r\n        return popouthtml;\r\n    }\r\n\r\n    function submitForm(modal) {\r\n\t\tmodal.getRoot().find('form').submit();\r\n\t}\r\n\r\n    function submitFormData(modal, contextid) {\r\n\t\tvar formData = modal.getRoot().find('form').serialize();\r\n        var notesuccess = String.get_string('successnotemessage', 'local_learningtools');\r\n\t\tAjax.call([{\r\n\t\t\tmethodname: 'ltool_note_save_usernote',\r\n\t\t\targs: {contextid: contextid, formdata: formData},\r\n\t\t\tdone: function(response) {\r\n\r\n\t\t\t\tmodal.hide();\r\n\t\t\t   // window.location.reload();\r\n                $.when(notesuccess).done(function(localizedEditString){\r\n                    notification.addNotification({\r\n                        message: localizedEditString,\r\n                        type: \"success\"\r\n                    });\r\n                });\r\n\r\n                if (disappertimenotify != 0) {\r\n                    setTimeout(function () {\r\n                        $(\"span.notifications\").empty();\r\n                    }, disappertimenotify);\r\n                }   \r\n\t\t\t},\r\n\t\t\tfail: handleFailedResponse()\r\n\t\t}]);  \r\n\t}\r\n\r\n    function handleFailedResponse() {\r\n\r\n    }\r\n\r\n    function getnoteaction(contextid, params) {\r\n        return Fragment.loadFragment('ltool_note', 'get_note_form', contextid, params);\r\n    }\r\n\r\n\r\n\r\n    return {\r\n        init: function(contextid, params) {\r\n            learning_tool_note_action(contextid, params);\r\n        }\r\n    };\r\n});"],"file":"learningnote.min.js"}