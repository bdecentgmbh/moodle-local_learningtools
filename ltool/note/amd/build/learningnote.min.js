define ("ltool_note/learningnote",["jquery","core/modal_factory","core/str","core/fragment","core/modal_events","core/ajax","core/notification"],function(a,b,c,d,e,f,g){function h(a,b){j(a,b);var c=document.querySelector(".ltnote-sortfilter i#notessorttype");if(c){c.addEventListener("click",function(){var a=this.getAttribute("data-type");k(a)})}}function i(a,b){var c=a.split("?");if(2<=c.length){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;0<f--;){if(-1!==e[f].lastIndexOf(d,0)){e.splice(f,1)}}a=c[0]+(0<e.length?"?"+e.join("&"):"");return a}else{return a}}function j(d,f){var g=document.querySelector(".ltnoteinfo #ltnote-action");g.addEventListener("click",function(){var g=c.get_string("newnote","local_learningtools");a.when(g).done(function(a){var c=document.getElementsByTagName("body")[0];if(!c.classList.contains("learningtool-note")){c.classList.add("learningtool-note")}b.create({title:a+l(f),type:b.types.SAVE_CANCEL,body:p(d,f),large:!0}).then(function(a){a.show();a.getRoot().on(e.hidden,function(){a.destroy()});a.getRoot().on(e.save,function(b){b.preventDefault();m(a)});document.querySelector("#popout-action").addEventListener("click",function(){var b=M.cfg.wwwroot+"/local/learningtools/ltool/note/pop_out.php?contextid="+f.contextid+"&pagetype="+f.pagetype+"&contextlevel="+f.contextlevel+"&course="+f.course+"&user="+f.user+"&pageurl="+f.pageurl+"&pagetitle="+f.pagetitle+"&heading="+f.heading;a.hide();window.open(b,"_blank")});document.body.onsubmit=function(b){b.preventDefault();n(a,d,f)}})})})}function k(a){var b=window.location.href;b=i(b,"sorttype");if("asc"==a){a="desc"}else if("desc"==a){a="asc"}if(-1<b.indexOf("?")){var c="&"}else{var c="?"}b=b+c+"sorttype="+a;window.open(b,"_self")}function l(){return"<div class='popout-block'><button type='submit' id='popout-action' name='popoutsubmit'>Pop out</button><i class='fa fa-window-restore'></i></div>"}function m(a){a.getRoot().submit()}function n(b,d){var e=document.querySelector(".ltoolusernotes form"),h=q(e),i=c.get_string("successnotemessage","local_learningtools");f.call([{methodname:"ltool_note_save_usernote",args:{contextid:d,formdata:h},done:function done(c){if(c){var d=document.querySelector(".ltnoteinfo span");if(!d.classList.contains("ticked")){d.classList.add("ticked")}d.innerHTML=c}b.hide();a.when(i).done(function(a){g.addNotification({message:a,type:"success"})});if(0!=ltools.disappertimenotify){setTimeout(function(){document.querySelector("span.notifications").innerHTML=""},ltools.disappertimenotify)}},fail:o()}])}function o(){}function p(a,b){b.contextid=a;if(""==b.pagetitle){b.pagetitle=document.querySelector("title").innerHTML}return d.loadFragment("ltool_note","get_note_form",a,b)}function q(a){if(!a||"FORM"!==a.nodeName){return}var b,c,d=[];for(b=a.elements.length-1;0<=b;b=b-1){if(""===a.elements[b].name){continue}switch(a.elements[b].nodeName){case"INPUT":switch(a.elements[b].type){case"text":case"tel":case"email":case"hidden":case"password":case"button":case"reset":case"submit":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value));break;case"checkbox":case"radio":if(a.elements[b].checked){d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value))}break;}break;case"file":break;case"TEXTAREA":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value));break;case"SELECT":switch(a.elements[b].type){case"select-one":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value));break;case"select-multiple":for(c=a.elements[b].options.length-1;0<=c;c=c-1){if(a.elements[b].options[c].selected){d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].options[c].value))}}break;}break;case"BUTTON":switch(a.elements[b].type){case"reset":case"submit":case"button":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value));break;}break;}}return d.join("&")}return{init:function init(a,b){h(a,b)}}});
//# sourceMappingURL=learningnote.min.js.map
