define ("ltool_note/learningnote",["jquery","core/modal_factory","core/str","core/fragment","core/modal_events","core/ajax","core/notification"],function(a,b,c,d,e,f,g){function h(a,b){j(a,b);var c=document.querySelector(".ltnote-sortfilter i#notessorttype");if(c){c.addEventListener("click",function(){var a=this.getAttribute("data-type");k(a)})}}function i(a,b){var c=a.split("?");if(2<=c.length){for(var d=encodeURIComponent(b)+"=",e=c[1].split(/[&;]/g),f=e.length;0<f--;){if(-1!==e[f].lastIndexOf(d,0)){e.splice(f,1)}}a=c[0]+(0<e.length?"?"+e.join("&"):"");return a}else{return a}}function j(d,f){var h=document.querySelector(".ltnoteinfo #ltnote-action");if(h){h.addEventListener("click",function(){var h=c.get_string("newnote","local_learningtools");a.when(h).done(function(a){var c=document.getElementsByTagName("body")[0];if(!c.classList.contains("learningtool-note")){c.classList.add("learningtool-note")}b.create({title:a+l(),type:b.types.SAVE_CANCEL,body:n(d,f),large:!0}).then(function(a){a.show();a.getRoot().on(e.hidden,function(){a.destroy()});a.getRoot().on(e.save,function(b){b.preventDefault();m(a,d);a.getRoot().submit()});document.querySelector("#popout-action").addEventListener("click",function(){var b=f.pageurl.split("&"),c=JSON.stringify(b),d=M.cfg.wwwroot+"/local/learningtools/ltool/note/pop_out.php?contextid="+f.contextid+"&pagetype="+f.pagetype+"&contextlevel="+f.contextlevel+"&course="+f.course+"&user="+f.user+"&pageurl="+c+"&pagetitle="+f.pagetitle+"&heading="+f.heading;a.hide();window.open(d,"_blank")});return a}).catch(g.exception)})});var i=h.getAttribute("data-hovercolor");if(i){h.addEventListener("mouseover",function(){document.querySelector("#ltnote-action p").style.background=i})}}}function k(a){var b=window.location.href;b=i(b,"sorttype");if("asc"==a){a="desc"}else if("desc"==a){a="asc"}var c="";if(-1<b.indexOf("?")){c="&"}else{c="?"}b=b+c+"sorttype="+a;window.open(b,"_self")}function l(){return"<div class='popout-block'><button type='submit' id='popout-action'name='popoutsubmit'>Pop out</button> <i class='fa fa-window-restore'></i></div>"}function m(b,d){var e=document.querySelectorAll(".ltoolusernotes form")[0],h=new URLSearchParams(new FormData(e)).toString(),i=c.get_string("successnotemessage","local_learningtools");f.call([{methodname:"ltool_note_save_usernote",args:{contextid:d,formdata:h},done:function done(c){if(c){var d=document.querySelector(".ltnoteinfo span");if(!d.classList.contains("ticked")){d.classList.add("ticked")}d.innerHTML=c}b.hide();a.when(i).done(function(a){g.addNotification({message:a,type:"success"})});if(0!=ltools.disappertimenotify){setTimeout(function(){document.querySelector("span.notifications").innerHTML=""},ltools.disappertimenotify)}}}])}function n(a,b){b.contextid=a;if(""==b.pagetitle){b.pagetitle=document.querySelector("title").innerHTML}return d.loadFragment("ltool_note","get_note_form",a,b)}return{init:function init(a,b){h(a,b)}}});
//# sourceMappingURL=learningnote.min.js.map
