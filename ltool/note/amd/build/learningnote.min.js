/**
 * Notes ltool define js.
 * @module   ltool_note
 * @category  Classes - autoloading
 * @copyright 2021, bdecent gmbh bdecent.de
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("ltool_note/learningnote",["jquery","core/modal_factory","core/str","core/fragment","core/modal_events","core/ajax","core/notification"],(function($,ModalFactory,String,Fragment,ModalEvents,Ajax,notification){function learningToolNoteAction(contextid,params){!function(contextid,params){var notesinfo=document.querySelector(".ltnoteinfo #ltnote-action");if(notesinfo){notesinfo.addEventListener("click",(function(){var newnote=String.get_string("newnote","local_learningtools");$.when(newnote).done((function(localizedEditString){var ltoolnotebody=document.getElementsByTagName("body")[0];ltoolnotebody.classList.contains("learningtool-note")||ltoolnotebody.classList.add("learningtool-note"),ModalFactory.create({title:localizedEditString+getPopoutAction(),type:ModalFactory.types.SAVE_CANCEL,body:getnoteaction(contextid,params),large:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),$(e.target).find("button[data-action=save]").attr("disabled",!0),modal.getRoot().find("form").submit()})),modal.getRoot().on("submit","form",(e=>{e.preventDefault(),function(modal,contextid){var modalform=document.querySelectorAll(".ltoolusernotes form")[0],formData=new URLSearchParams(new FormData(modalform)).toString(),notesuccess=String.get_string("successnotemessage","local_learningtools");Ajax.call([{methodname:"ltool_note_save_usernote",args:{contextid:contextid,formdata:formData},done:function(response){if(response){var noteinfo=document.querySelector(".ltnoteinfo span");noteinfo.classList.contains("ticked")||noteinfo.classList.add("ticked"),noteinfo.innerHTML=response}modal.hide(),$.when(notesuccess).done((function(localizedEditString){notification.addNotification({message:localizedEditString,type:"success"})})),0!=ltools.disappertimenotify&&setTimeout((function(){document.querySelector("span.notifications").innerHTML=""}),ltools.disappertimenotify)}}])}(modal,contextid)})),document.querySelector("#popout-action").addEventListener("click",(function(){var pageurlobj=params.pageurl.split("&"),pageurljson=JSON.stringify(pageurlobj),url=M.cfg.wwwroot+"/local/learningtools/ltool/note/pop_out.php?contextid="+params.contextid+"&pagetype="+params.pagetype+"&contextlevel="+params.contextlevel+"&course="+params.course+"&user="+params.user+"&pageurl="+pageurljson+"&pagetitle="+params.pagetitle+"&heading="+params.heading+"&sesskey="+params.sesskey;modal.hide(),window.open(url,"_blank")})),modal})).catch(notification.exception)}))}));var notehovercolor=notesinfo.getAttribute("data-hovercolor"),notefontcolor=notesinfo.getAttribute("data-fontcolor");notehovercolor&&notefontcolor&&notesinfo.addEventListener("mouseover",(function(){document.querySelector("#ltnoteinfo p").style.background=notehovercolor,document.querySelector("#ltnoteinfo p").style.color=notefontcolor}))}}(contextid,params);var sorttypefilter=document.querySelector(".ltnote-sortfilter i#notessorttype");sorttypefilter&&sorttypefilter.addEventListener("click",(function(){!function(sorttype){var pageurl=window.location.href;pageurl=function(url,parameter){var urlparts=url.split("?");if(urlparts.length>=2){for(var prefix=encodeURIComponent(parameter)+"=",pars=urlparts[1].split(/[&;]/g),i=pars.length;i-- >0;)-1!==pars[i].lastIndexOf(prefix,0)&&pars.splice(i,1);return url=urlparts[0]+(pars.length>0?"?"+pars.join("&"):"")}return url}(pageurl,"sorttype"),"asc"==sorttype?sorttype="desc":"desc"==sorttype&&(sorttype="asc");var para="";para=pageurl.indexOf("?")>-1?"&":"?";pageurl=pageurl+para+"sorttype="+sorttype,window.open(pageurl,"_self")}(this.getAttribute("data-type"))}))}function getPopoutAction(){return"<div class='popout-block'><button type='submit' id='popout-action'name='popoutsubmit'>Pop out</button> <i class='fa fa-window-restore'></i></div>"}function getnoteaction(contextid,params){return params.contextid=contextid,""==params.pagetitle&&(params.pagetitle=document.querySelector("title").innerHTML),Fragment.loadFragment("ltool_note","get_note_form",contextid,params)}return{init:function(contextid,params){learningToolNoteAction(contextid,params)}}}));

//# sourceMappingURL=learningnote.min.js.map