{"version":3,"sources":["../src/learningbookmarks.js"],"names":["define","String","Ajax","notification","learning_tool_bookmarks_action","contextid","params","bookmarkmarked","document","getElementById","pagebookmarks","classList","add","remove","bookmarksform","addEventListener","e","preventDefault","submitFormdata","bookmarkssorttype","sorttype","getAttribute","bookmarks_sort_action_page","pageurl","window","location","href","removeURLParameter","indexOf","para","open","url","parameter","urlparts","split","length","prefix","encodeURIComponent","pars","i","lastIndexOf","splice","join","formData","Formdata","JSON","stringify","call","methodname","args","formdata","done","response","addNotification","message","bookmarksmsg","type","notificationtype","bookmarksstatus","ltools","disappertimenotify","setTimeout","querySelector","innerHTML","fail","handleFailedResponse","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Bookmarks ltool define js.\r\n * @package   ltool_bookmarks\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['core/str', 'core/ajax', 'core/notification'],\r\n    function(String, Ajax, notification){\r\n\r\n\r\n    /**\r\n     * Controls bookmarks tool action.\r\n     * @param {int} context id\r\n     * @param {object} bookmarks info params\r\n     */\r\n    function learning_tool_bookmarks_action(contextid, params) {\r\n\r\n        var bookmarkmarked = document.getElementById('bookmarks-marked');\r\n        if (bookmarkmarked) {\r\n            if (pagebookmarks) {\r\n                bookmarkmarked.classList.add('marked');\r\n            } else {\r\n                bookmarkmarked.classList.remove('marked');\r\n            }\r\n        }\r\n\r\n        var bookmarksform = document.getElementById('ltbookmarks-action');\r\n        if (bookmarksform) {\r\n            bookmarksform.addEventListener(\"click\", function(e) {\r\n                e.preventDefault();\r\n                submitFormdata(contextid, params);\r\n            });\r\n        }\r\n        var bookmarkssorttype = document.getElementById(\"bookmarkssorttype\");\r\n\r\n        if (bookmarkssorttype) {\r\n            bookmarkssorttype.addEventListener(\"click\", function() {\r\n                var sorttype = this.getAttribute(\"data-type\");\r\n                bookmarks_sort_action_page(sorttype);\r\n            });\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * Sort the bookmarks list.\r\n     * @param {string} sort type\r\n     * @return {void}\r\n     */\r\n    function bookmarks_sort_action_page(sorttype) {\r\n\r\n        var pageurl = window.location.href;\r\n        pageurl = removeURLParameter(pageurl, 'sorttype');\r\n\r\n        if(sorttype == 'asc') {\r\n            sorttype = 'desc';\r\n        } else if (sorttype == 'desc') {\r\n            sorttype = 'asc';\r\n        }\r\n\r\n        if (pageurl.indexOf('?') > -1) {\r\n            var para = '&';\r\n        } else {\r\n            var para = '?';\r\n        }\r\n\r\n        pageurl = pageurl+para+'sorttype='+ sorttype;\r\n        window.open(pageurl, '_self');\r\n    }\r\n\r\n\r\n    /**\r\n     * Clean the url parameters.\r\n     * @param {string} page url.\r\n     * @param {string} url parameter.\r\n     * @return {url} sort url\r\n     */\r\n    function removeURLParameter(url, parameter) {\r\n        //prefer to use l.search if you have a location/link object\r\n        var urlparts= url.split('?');\r\n        if (urlparts.length>=2) {\r\n\r\n            var prefix= encodeURIComponent(parameter)+'=';\r\n            var pars= urlparts[1].split(/[&;]/g);\r\n\r\n            //reverse iteration as may be destructive\r\n            for (var i= pars.length; i-- > 0;) {\r\n                //idiom for string.startsWith\r\n                if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                    pars.splice(i, 1);\r\n                }\r\n            }\r\n            url= urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : \"\");\r\n            return url;\r\n        } else {\r\n            return url;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bookmarks submit the form data.\r\n     * @param {int} context id.\r\n     * @param {object} form instance data.\r\n     * @return {void} ajax response\r\n     */\r\n    function submitFormdata(contextid, formData) {\r\n\r\n        var Formdata = JSON.stringify(formData);\r\n        Ajax.call([{\r\n            methodname: 'ltool_bookmarks_save_userbookmarks',\r\n            args: {contextid: contextid, formdata: Formdata},\r\n            done: function(response) {\r\n\r\n                notification.addNotification({\r\n                    message: response.bookmarksmsg,\r\n                    type: response.notificationtype\r\n                });\r\n\r\n                let bookmarkmarked = document.getElementById('bookmarks-marked');\r\n                if (response.bookmarksstatus) {\r\n                    bookmarkmarked.classList.add('marked');\r\n                } else {\r\n                    bookmarkmarked.classList.remove('marked');\r\n                }\r\n\r\n                if (ltools.disappertimenotify != 0) {\r\n                    setTimeout(function () {\r\n                        var notifications = document.querySelector(\"span.notifications\").innerHTML = \"\";\r\n                    }, ltools.disappertimenotify);\r\n                }\r\n\r\n            },\r\n            fail: handleFailedResponse()\r\n        }]);\r\n    }\r\n\r\n\r\n    function handleFailedResponse() {\r\n\r\n    }\r\n    return {\r\n        init: function(contextid, params) {\r\n            learning_tool_bookmarks_action(contextid, params);\r\n        }\r\n    };\r\n});\r\n"],"file":"learningbookmarks.min.js"}