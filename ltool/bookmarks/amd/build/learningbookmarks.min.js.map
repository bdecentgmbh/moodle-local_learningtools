{"version":3,"sources":["../src/learningbookmarks.js"],"names":["define","String","Ajax","notification","learningToolBookmarksAction","contextid","params","bookmarkmarked","document","getElementById","pagebookmarks","classList","add","remove","bookmarksform","addEventListener","e","preventDefault","submitFormdata","bookmarkshovercolor","getAttribute","querySelector","style","background","bookmarkssorttype","sorttype","bookmarksSortActionPage","pageurl","window","location","href","para","removeURLParameter","indexOf","open","url","parameter","urlparts","split","length","prefix","encodeURIComponent","pars","i","lastIndexOf","splice","join","formData","pagetitle","innerHTML","Formdata","JSON","stringify","call","methodname","args","formdata","done","response","addNotification","message","bookmarksmsg","type","notificationtype","bookmarksstatus","ltools","disappertimenotify","setTimeout","init"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Bookmarks ltool define js.\n * @package   ltool_bookmarks\n * @category  Classes - autoloading\n * @copyright 2021, bdecent gmbh bdecent.de\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/str', 'core/ajax', 'core/notification'],\n    function(String, Ajax, notification) {\n\n    /* global ltools, pagebookmarks */\n\n    /**\n     * Controls bookmarks tool action.\n     * @param {int} contextid\n     * @param {object} params\n     */\n    function learningToolBookmarksAction(contextid, params) {\n\n        var bookmarkmarked = document.getElementById('bookmarks-marked');\n        if (bookmarkmarked) {\n            if (pagebookmarks) {\n                bookmarkmarked.classList.add('marked');\n            } else {\n                bookmarkmarked.classList.remove('marked');\n            }\n        }\n\n        var bookmarksform = document.getElementById('ltbookmarks-action');\n        if (bookmarksform) {\n            bookmarksform.addEventListener(\"click\", function(e) {\n                e.preventDefault();\n                submitFormdata(contextid, params);\n            });\n            // Hover color.\n            var bookmarkshovercolor = bookmarksform.getAttribute(\"data-hovercolor\");\n            if (bookmarkshovercolor) {\n                bookmarksform.addEventListener(\"mouseover\", function() {\n                    document.querySelector('#ltbookmarks-action p').style.background = bookmarkshovercolor;\n                });\n            }\n\n        }\n        var bookmarkssorttype = document.getElementById(\"bookmarkssorttype\");\n\n        if (bookmarkssorttype) {\n            bookmarkssorttype.addEventListener(\"click\", function() {\n                var sorttype = this.getAttribute(\"data-type\");\n                bookmarksSortActionPage(sorttype);\n            });\n        }\n    }\n\n    /**\n     * Sort the bookmarks list.\n     * @param {string} sorttype type of sort\n     * @return {void}\n     */\n    function bookmarksSortActionPage(sorttype) {\n\n        var pageurl = window.location.href;\n        var para = '';\n        pageurl = removeURLParameter(pageurl, 'sorttype');\n\n        if (sorttype == 'asc') {\n            sorttype = 'desc';\n        } else if (sorttype == 'desc') {\n            sorttype = 'asc';\n        }\n\n        if (pageurl.indexOf('?') > -1) {\n            para = '&';\n        } else {\n            para = '?';\n        }\n\n        pageurl = pageurl + para + 'sorttype=' + sorttype;\n        window.open(pageurl, '_self');\n    }\n\n\n    /**\n     * Clean the url parameters.\n     * @param {string} url page url.\n     * @param {string} parameter url parameter.\n     * @return {url} sort url\n     */\n    function removeURLParameter(url, parameter) {\n        // Prefer to use l.search if you have a location/link object.\n        var urlparts = url.split('?');\n        if (urlparts.length >= 2) {\n\n            var prefix = encodeURIComponent(parameter) + '=';\n            var pars = urlparts[1].split(/[&;]/g);\n\n            // Reverse iteration as may be destructive.\n            for (var i = pars.length; i-- > 0;) {\n                // Idiom for string.startsWith.\n                if (pars[i].lastIndexOf(prefix, 0) !== -1) {\n                    pars.splice(i, 1);\n                }\n            }\n            url = urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : \"\");\n            return url;\n        } else {\n            return url;\n        }\n    }\n\n    /**\n     * Bookmarks submit the form data.\n     * @param {int} contextid context id.\n     * @param {object} formData form instance data.\n     * @return {void} ajax response\n     */\n    function submitFormdata(contextid, formData) {\n\n        if (formData.pagetitle == \"\") {\n            formData.pagetitle = document.querySelector('title').innerHTML;\n        }\n        var Formdata = JSON.stringify(formData);\n        Ajax.call([{\n            methodname: 'ltool_bookmarks_save_userbookmarks',\n            args: {contextid: contextid, formdata: Formdata},\n            done: function(response) {\n\n                notification.addNotification({\n                    message: response.bookmarksmsg,\n                    type: response.notificationtype\n                });\n\n                let bookmarkmarked = document.getElementById('bookmarks-marked');\n                if (response.bookmarksstatus) {\n                    bookmarkmarked.classList.add('marked');\n                } else {\n                    bookmarkmarked.classList.remove('marked');\n                }\n\n                if (ltools.disappertimenotify != 0) {\n                    setTimeout(function() {\n                        document.querySelector(\"span.notifications\").innerHTML = \"\";\n                    }, ltools.disappertimenotify);\n                }\n\n            },\n        }]);\n    }\n\n    return {\n        init: function(contextid, params) {\n            learningToolBookmarksAction(contextid, params);\n        }\n    };\n});\n"],"file":"learningbookmarks.min.js"}