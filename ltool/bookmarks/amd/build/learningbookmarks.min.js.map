{"version":3,"file":"learningbookmarks.min.js","sources":["../src/learningbookmarks.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Bookmarks ltool define js.\r\n * @module   ltool_bookmarks\r\n * @category  Classes - autoloading\r\n * @copyright 2021, bdecent gmbh bdecent.de\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['core/str', 'core/ajax', 'core/notification', 'jquery'],\r\n    function(String, Ajax, notification, $, str) {\r\n\r\n    /* global ltools, pagebookmarks */\r\n\r\n    /**\r\n     * Controls bookmarks tool action.\r\n     * @param {int} contextid\r\n     * @param {object} params\r\n     */\r\n    function learningToolBookmarksAction(contextid, params) {\r\n\r\n        var bookmarkmarked = document.getElementById('bookmarks-marked');\r\n        if (bookmarkmarked) {\r\n            if (pagebookmarks) {\r\n                bookmarkmarked.classList.add('marked');\r\n            } else {\r\n                bookmarkmarked.classList.remove('marked');\r\n            }\r\n        }\r\n\r\n        var bookmarksform = document.getElementById('ltbookmarks-action');\r\n        if (bookmarksform) {\r\n            bookmarksform.addEventListener(\"click\", function(e) {\r\n                e.preventDefault();\r\n                submitFormdata(contextid, params);\r\n            });\r\n            // Hover color.\r\n            var bookmarkshovercolor = bookmarksform.getAttribute(\"data-hovercolor\");\r\n            var bookmarksfontcolor = bookmarksform.getAttribute(\"data-fontcolor\");\r\n            if (bookmarkshovercolor && bookmarksfontcolor) {\r\n                bookmarksform.addEventListener(\"mouseover\", function() {\r\n                    document.querySelector('#ltbookmarksinfo p').style.background = bookmarkshovercolor;\r\n                    document.querySelector('#ltbookmarksinfo p').style.color = bookmarksfontcolor;\r\n                });\r\n            }\r\n\r\n        }\r\n\r\n        // Content designer bookmarks.\r\n        $(document).on('click', '.content-designer-learningtool-bookmark', function(e) {\r\n            e.preventDefault();\r\n            var button = $(this);\r\n            var itemType = button.data('itemtype');\r\n            var itemId = button.data('itemid');\r\n            var userid = button.data('userid');\r\n            var sesskey = button.data('sesskey');\r\n            var course = button.data('courseid');\r\n            var coursemodule = button.data('coursemodule');\r\n            var contextlevel = button.data('contextlevel');\r\n            var pagetype = button.data('pagetype');\r\n            // Prepare the parameters for the bookmark.\r\n            var contextId = M.cfg.contextid;\r\n            var params = {\r\n                pagetitle: document.title,\r\n                pageurl: window.location.href,\r\n                pageid: 0,\r\n                itemtype: itemType,\r\n                itemid: itemId,\r\n                user: userid,\r\n                sesskey: sesskey,\r\n                course: course,\r\n                coursemodule: coursemodule,\r\n                contextlevel: contextlevel,\r\n                pagetype: pagetype,\r\n            };\r\n            submitFormdata(contextId, params, button);\r\n        });\r\n\r\n        var bookmarkssorttype = document.getElementById(\"bookmarkssorttype\");\r\n\r\n        if (bookmarkssorttype) {\r\n            bookmarkssorttype.addEventListener(\"click\", function() {\r\n                var sorttype = this.getAttribute(\"data-type\");\r\n                bookmarksSortActionPage(sorttype);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sort the bookmarks list.\r\n     * @param {string} sorttype type of sort\r\n     * @return {void}\r\n     */\r\n    function bookmarksSortActionPage(sorttype) {\r\n\r\n        var pageurl = window.location.href;\r\n        var para = '';\r\n        pageurl = removeURLParameter(pageurl, 'sorttype');\r\n\r\n        if (sorttype == 'asc') {\r\n            sorttype = 'desc';\r\n        } else if (sorttype == 'desc') {\r\n            sorttype = 'asc';\r\n        }\r\n\r\n        if (pageurl.indexOf('?') > -1) {\r\n            para = '&';\r\n        } else {\r\n            para = '?';\r\n        }\r\n\r\n        pageurl = pageurl + para + 'sorttype=' + sorttype;\r\n        window.open(pageurl, '_self');\r\n    }\r\n\r\n\r\n    /**\r\n     * Clean the url parameters.\r\n     * @param {string} url page url.\r\n     * @param {string} parameter url parameter.\r\n     * @return {url} sort url\r\n     */\r\n    function removeURLParameter(url, parameter) {\r\n        // Prefer to use l.search if you have a location/link object.\r\n        var urlparts = url.split('?');\r\n        if (urlparts.length >= 2) {\r\n\r\n            var prefix = encodeURIComponent(parameter) + '=';\r\n            var pars = urlparts[1].split(/[&;]/g);\r\n\r\n            // Reverse iteration as may be destructive.\r\n            for (var i = pars.length; i-- > 0;) {\r\n                // Idiom for string.startsWith.\r\n                if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                    pars.splice(i, 1);\r\n                }\r\n            }\r\n            url = urlparts[0] + (pars.length > 0 ? '?' + pars.join('&') : \"\");\r\n            return url;\r\n        } else {\r\n            return url;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Bookmarks submit the form data.\r\n     * @param {int} contextid context id.\r\n     * @param {object} formData form instance data.\r\n     * @return {void} ajax response\r\n     */\r\n    function submitFormdata(contextid, formData, button = null) {\r\n\r\n        if (formData.pagetitle == \"\") {\r\n            formData.pagetitle = document.querySelector('title').innerHTML;\r\n        }\r\n        var Formdata = JSON.stringify(formData);\r\n        Ajax.call([{\r\n            methodname: 'ltool_bookmarks_save_userbookmarks',\r\n            args: {contextid: contextid, formdata: Formdata},\r\n            done: function(response) {\r\n\r\n                notification.addNotification({\r\n                    message: response.bookmarksmsg,\r\n                    type: response.notificationtype\r\n                });\r\n\r\n\r\n                let bookmarkmarked = document.getElementById('bookmarks-marked');\r\n                if (response.bookmarksstatus) {\r\n                    if (button) {\r\n                        require(['mod_contentdesigner/elements'], function(Elements) {\r\n                            var chapterId = formData.itemid;\r\n                            if (chapterId) {\r\n                                Elements.refreshContent();\r\n                            }\r\n                        });\r\n                    } else {\r\n                        bookmarkmarked.classList.add('marked');\r\n                    }\r\n                } else {\r\n                    if (button) {\r\n                        require(['mod_contentdesigner/elements'], function(Elements) {\r\n                            var chapterId = formData.itemid;\r\n                            if (chapterId) {\r\n                                Elements.refreshContent();\r\n                            }\r\n                        });\r\n                    } else {\r\n                        bookmarkmarked.classList.remove('marked');\r\n                    }\r\n                }\r\n\r\n                if (ltools.disappertimenotify != 0) {\r\n                    setTimeout(function() {\r\n                        document.querySelector(\"span.notifications\").innerHTML = \"\";\r\n                    }, ltools.disappertimenotify);\r\n                }\r\n\r\n            },fail: function(error) {\r\n                notification.exception(error);\r\n            }\r\n        }]);\r\n    }\r\n\r\n    return {\r\n        init: function(contextid, params) {\r\n            learningToolBookmarksAction(contextid, params);\r\n        }\r\n    };\r\n});\r\n"],"names":["define","String","Ajax","notification","$","str","learningToolBookmarksAction","contextid","params","bookmarkmarked","document","getElementById","pagebookmarks","classList","add","remove","bookmarksform","addEventListener","e","preventDefault","submitFormdata","bookmarkshovercolor","getAttribute","bookmarksfontcolor","querySelector","style","background","color","on","button","this","itemType","data","itemId","userid","sesskey","course","coursemodule","contextlevel","pagetype","M","cfg","pagetitle","title","pageurl","window","location","href","pageid","itemtype","itemid","user","bookmarkssorttype","sorttype","para","url","parameter","urlparts","split","length","prefix","encodeURIComponent","pars","i","lastIndexOf","splice","join","removeURLParameter","indexOf","open","bookmarksSortActionPage","formData","innerHTML","Formdata","JSON","stringify","call","methodname","args","formdata","done","response","addNotification","message","bookmarksmsg","type","notificationtype","bookmarksstatus","require","Elements","refreshContent","ltools","disappertimenotify","setTimeout","fail","error","exception","init"],"mappings":"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"}